<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Multi-Category Quiz</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #101a33;
      --ink: #eaf0ff;
      --muted: #aab6d3;
      --accent: #6aa1ff;
      --accent-2: #9be1ff;
      --shadow: 0 10px 30px rgba(0,0,0,.35), 0 2px 8px rgba(0,0,0,.25);
    }
    html, body { height: 100%; }
    body {
      margin: 0; background: radial-gradient(1200px 800px at 30% -10%, #132240 0%, #0b1220 60%);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--ink); display: grid; place-items: center; padding: 20px;
    }
    .app { width: min(900px, 96vw); }
    h1 { font-weight: 700; letter-spacing: .3px; margin: 0 0 14px; font-size: clamp(20px, 3.3vw, 32px); color: var(--accent-2); }

    .bar { display: flex; gap: 10px; align-items: center; justify-content: space-between; margin-bottom: 12px; flex-wrap: wrap; }
    .pill { background: rgba(255,255,255,.06); border: 1px solid rgba(255,255,255,.08); color: var(--muted); padding: 8px 12px; border-radius: 999px; font-size: 13px; }

    .category-selector {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px; padding: clamp(18px, 3.5vw, 28px);
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    
    .category-selector h2 {
      margin: 0 0 16px 0;
      font-size: clamp(18px, 2.5vw, 24px);
      color: var(--accent);
    }
    
    .category-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
    }
    
    .category-btn {
      background: linear-gradient(180deg, rgba(106,161,255,.15), rgba(106,161,255,.08));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s ease;
      font-weight: 600;
    }
    
    .category-btn:hover {
      background: linear-gradient(180deg, rgba(106,161,255,.25), rgba(106,161,255,.15));
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,.3);
    }
    
    .category-btn.selected {
      background: linear-gradient(180deg, rgba(155,225,255,.25), rgba(155,225,255,.15));
      border-color: var(--accent-2);
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 18px; padding: clamp(18px, 3.5vw, 28px);
      box-shadow: var(--shadow);
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .card:active { transform: scale(.998); box-shadow: 0 6px 18px rgba(0,0,0,.35); }

    .q { font-size: clamp(20px, 3vw, 28px); line-height: 1.3; margin: 0; }
    .a { margin-top: 14px; font-size: clamp(18px, 2.3vw, 22px); color: #d6f2ff; display: none; }
    .a.show { display: block; }

    .controls { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 16px; }
    button {
      -webkit-tap-highlight-color: transparent;
      appearance: none; cursor: pointer; user-select: none;
      border: 1px solid rgba(255,255,255,.14); color: var(--ink);
      background: linear-gradient(180deg, rgba(106,161,255,.22), rgba(106,161,255,.12));
      border-radius: 14px; padding: 12px 14px; font-size: 15px; font-weight: 600;
      box-shadow: var(--shadow); transition: transform .1s ease, filter .2s ease, background .2s ease;
    }
    button:hover { filter: brightness(1.05); }
    button:active { transform: translateY(1px) scale(.998); }
    .ghost { background: rgba(255,255,255,.06); }

    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 10px; }
    .row label { font-size: 14px; color: var(--muted); display: flex; align-items: center; gap: 8px; }

    .progress { margin-top: 8px; font-size: 13px; color: var(--muted); display: flex; justify-content: space-between; align-items: center; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; color: #cfe1ff; opacity: .9; }

    .hidden { display: none; }

    .file-input {
      background: linear-gradient(180deg, rgba(106,161,255,.08), rgba(106,161,255,.04));
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      margin-bottom: 16px;
    }

    .file-input input[type="file"] {
      display: none;
    }

    .file-input label {
      cursor: pointer;
      color: var(--accent);
      font-weight: 600;
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
    }

    .file-input .hint {
      font-size: 11px;
      color: var(--muted);
    }

    .loaded-files {
      margin-top: 12px;
      text-align: left;
    }

    .loaded-files h3 {
      margin: 0 0 8px 0;
      font-size: 13px;
      color: var(--accent);
    }

    .file-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .file-list li {
      background: rgba(255,255,255,.03);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 6px;
      padding: 6px 10px;
      margin-bottom: 4px;
      font-size: 11px;
      color: var(--muted);
    }

    .file-list .success {
      color: #4ade80;
    }

    .file-list .error {
      color: #f87171;
    }

    .add-more-btn {
      background: linear-gradient(180deg, rgba(106,161,255,.12), rgba(106,161,255,.06));
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 12px;
      color: var(--accent);
      margin-top: 8px;
      width: 100%;
    }

    .add-more-btn:hover {
      background: linear-gradient(180deg, rgba(106,161,255,.18), rgba(106,161,255,.1));
    }

    @media (max-width: 520px) {
      .controls { grid-template-columns: 1fr; }
      .row { gap: 14px; }
      .category-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Category Selector -->
    <div class="category-selector" id="categorySelector">
      <h2>Choose a Quiz Category</h2>
      
      <!-- File Upload Section (only visible when no categories loaded) -->
      <div class="file-input" id="fileInput">
        <label for="csvFile">üìÅ Choose CSV Quiz Files</label>
        <input type="file" id="csvFile" accept=".csv" multiple>
        <div class="hint">Hold Ctrl/Cmd to select multiple CSV files with Question,Answer format</div>
        
        <div class="loaded-files hidden" id="loadedFiles">
          <h3>Loaded Files:</h3>
          <ul class="file-list" id="fileList"></ul>
        </div>
      </div>

      <!-- Add More Files Button (only visible when categories are loaded) -->
      <button class="add-more-btn hidden" id="addMoreBtn">
        ÔøΩÔøΩ Add More CSV Files
      </button>

      <div class="category-grid" id="categoryGrid">
        <div class="category-btn">Select CSV files to get started...</div>
      </div>
    </div>

    <!-- Quiz Interface -->
    <div class="hidden" id="quizInterface">
      <div class="bar">
        <h1 id="quizTitle">Quick‚ÄëFire Quiz</h1>
        <div class="pill"><span id="counter">Loading...</span></div>
      </div>

      <div class="card" id="card" aria-live="polite">
        <p class="q" id="q">Loading‚Ä¶</p>
        <p class="a" id="a"><strong>Answer:</strong> <span id="answerText"></span></p>
      </div>

      <div class="controls" aria-label="Controls">
        <button id="prev" title="Previous (‚Üê)">‚óÄ Prev</button>
        <button id="toggle" class="ghost" title="Show/Hide Answer (Space)">Show Answer</button>
        <button id="next" title="Next (‚Üí)">Next ‚ñ∂</button>
      </div>

      <div class="row">
        <label><input type="checkbox" id="startRandom" checked> Start in random order</label>
        <label><input type="checkbox" id="looping" checked> Loop at ends</label>
        <button id="reshuffle" class="ghost" title="Reshuffle order (R)">Reshuffle</button>
        <button id="restart" class="ghost">Restart</button>
        <button id="backToCategories" class="ghost">‚Üê Back to Categories</button>
      </div>

      <div class="progress">
        <div>Shortcuts: <span class="kbd">‚Üê/‚Üí</span> prev/next, <span class="kbd">Space</span> show, <span class="kbd">R</span> reshuffle</div>
        <div class="kbd">Tip: Click the card to toggle the answer.</div>
      </div>
    </div>
  </div>

  <script>
    // === CSV PARSER ===
    function parseCSV(csv) {
      const lines = csv.split('\n');
      const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
      const data = [];
      
      for (let i = 1; i < lines.length; i++) {
        if (lines[i].trim() === '') continue;
        
        const values = [];
        let current = '';
        let inQuotes = false;
        
        for (let j = 0; j < lines[i].length; j++) {
          const char = lines[i][j];
          
          if (char === '"') {
            inQuotes = !inQuotes;
          } else if (char === ',' && !inQuotes) {
            values.push(current.trim());
            current = '';
          } else {
            current += char;
          }
        }
        values.push(current.trim());
        
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] ? values[index].replace(/^"|"$/g, '') : '';
        });
        data.push(row);
      }
      
      return data;
    }

    // === APP STATE ===
    let QA = [];
    let currentCategory = '';
    let availableCategories = [];
    
    // DOM Elements
    const fileInput = document.getElementById('fileInput');
    const addMoreBtn = document.getElementById('addMoreBtn');
    const loadedFiles = document.getElementById('loadedFiles');
    const fileList = document.getElementById('fileList');
    const categorySelector = document.getElementById('categorySelector');
    const categoryGrid = document.getElementById('categoryGrid');
    const quizInterface = document.getElementById('quizInterface');
    const quizTitle = document.getElementById('quizTitle');
    const qEl = document.getElementById('q');
    const aEl = document.getElementById('a');
    const answerText = document.getElementById('answerText');
    const counterEl = document.getElementById('counter');
    const btnPrev = document.getElementById('prev');
    const btnNext = document.getElementById('next');
    const btnToggle = document.getElementById('toggle');
    const btnReshuffle = document.getElementById('reshuffle');
    const btnRestart = document.getElementById('restart');
    const btnBackToCategories = document.getElementById('backToCategories');
    const startRandom = document.getElementById('startRandom');
    const looping = document.getElementById('looping');
    const card = document.getElementById('card');

    let order = [];
    let idx = 0;

    // === FILE HANDLING ===
    document.getElementById('csvFile').addEventListener('change', handleFileSelect);
    addMoreBtn.addEventListener('click', () => {
      document.getElementById('csvFile').click();
    });

    function handleFileSelect(event) {
      const files = event.target.files;
      if (files.length === 0) return;

      // Clear previous file list
      fileList.innerHTML = '';
      
      let loadedCount = 0;
      const totalFiles = files.length;

      Array.from(files).forEach((file, index) => {
        if (file.type === 'text/csv' || file.name.endsWith('.csv')) {
          const reader = new FileReader();
          
          reader.onload = function(e) {
            try {
              const csvText = e.target.result;
              const csvData = parseCSV(csvText);
              
              // Convert CSV data to the expected format
              const questions = csvData.map(row => {
                const question = row.Question || row.question || row.Q || row.q || Object.values(row)[0];
                const answer = row.Answer || row.answer || row.A || row.a || Object.values(row)[1];
                return { q: question, a: answer };
              }).filter(qa => qa.q && qa.a);
              
              if (questions.length > 0) {
                const categoryName = file.name.replace('.csv', '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
                availableCategories.push({
                  filename: file.name,
                  name: categoryName,
                  questions: questions
                });
                
                // Add success message to file list
                addFileToList(file.name, `‚úÖ Loaded ${questions.length} questions`, 'success');
              } else {
                addFileToList(file.name, '‚ùå No valid questions found', 'error');
              }
            } catch (error) {
              console.error('Error parsing CSV:', error);
              addFileToList(file.name, `‚ùå Error: ${error.message}`, 'error');
            }
            
            loadedCount++;
            
            // If all files are processed, update UI
            if (loadedCount === totalFiles) {
              updateUIAfterFileLoad();
            }
          };
          
          reader.onerror = function() {
            addFileToList(file.name, '‚ùå Failed to read file', 'error');
            loadedCount++;
            
            if (loadedCount === totalFiles) {
              updateUIAfterFileLoad();
            }
          };
          
          reader.readAsText(file);
        } else {
          addFileToList(file.name, '‚ùå Not a CSV file', 'error');
          loadedCount++;
          
          if (loadedCount === totalFiles) {
            updateUIAfterFileLoad();
          }
        }
      });
      
      // Show the loaded files section
      loadedFiles.classList.remove('hidden');
    }

    function updateUIAfterFileLoad() {
      if (availableCategories.length > 0) {
        // Hide file input, show add more button
        fileInput.classList.add('hidden');
        addMoreBtn.classList.remove('hidden');
        
        // Update category grid
        createCategoryButtons(availableCategories);
      }
    }

    function addFileToList(filename, message, status) {
      const li = document.createElement('li');
      li.className = status;
      li.innerHTML = `<strong>${filename}</strong>: ${message}`;
      fileList.appendChild(li);
    }

    // === CATEGORY SELECTION ===
    function showCategorySelector() {
      categorySelector.classList.remove('hidden');
      quizInterface.classList.add('hidden');
      currentCategory = '';
      QA = [];
    }

    function showQuizInterface() {
      categorySelector.classList.add('hidden');
      quizInterface.classList.remove('hidden');
    }

    function createCategoryButtons(categories) {
      if (categories.length === 0) {
        categoryGrid.innerHTML = `
          <div class="category-btn" style="grid-column: 1 / -1; color: var(--muted);">
            No valid CSV files loaded. Please select CSV files with Question,Answer format.
          </div>
        `;
        return;
      }

      categoryGrid.innerHTML = categories.map(category => `
        <div class="category-btn" data-filename="${category.filename}">
          <div style="font-size: 18px; margin-bottom: 4px;">${category.name}</div>
          <div style="font-size: 12px; color: var(--muted);">${category.questions.length} questions</div>
        </div>
      `).join('');

      // Add click handlers
      categoryGrid.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const filename = btn.dataset.filename;
          loadCategory(filename);
        });
      });
    }

    // === LOAD CATEGORY ===
    function loadCategory(filename) {
      const category = availableCategories.find(cat => cat.filename === filename);
      if (!category) {
        alert('Category not found');
        return;
      }

      QA = category.questions;
      currentCategory = category.name;
      quizTitle.textContent = currentCategory;
      
      showQuizInterface();
      setOrder(true);
      render(true);
    }

    function shuffle(arr){
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function setOrder(randomize) {
      order = [...Array(QA.length).keys()];
      if (randomize) shuffle(order);
      idx = 0;
    }

    function render(hideAnswer = true) {
      if (QA.length === 0) return;
      
      const qa = QA[ order[idx] ];
      qEl.textContent = qa.q;
      answerText.textContent = qa.a;
      if (hideAnswer) aEl.classList.remove('show');
      counterEl.textContent = `${idx+1} / ${QA.length}`;
    }

    function next() {
      if (idx < order.length - 1) { idx++; render(); }
      else if (looping.checked) { idx = 0; render(); }
    }

    function prev() {
      if (idx > 0) { idx--; render(); }
      else if (looping.checked) { idx = order.length - 1; render(); }
    }

    function toggleAnswer() {
      aEl.classList.toggle('show');
      btnToggle.textContent = aEl.classList.contains('show') ? 'Hide Answer' : 'Show Answer';
    }

    // Events
    btnNext.addEventListener('click', next);
    btnPrev.addEventListener('click', prev);
    btnToggle.addEventListener('click', toggleAnswer);
    btnReshuffle.addEventListener('click', () => { setOrder(true); render(true); });
    btnRestart.addEventListener('click', () => { setOrder(startRandom.checked); render(true); });
    btnBackToCategories.addEventListener('click', showCategorySelector);
    card.addEventListener('click', toggleAnswer);

    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowRight') { e.preventDefault(); next(); }
      else if (e.key === 'ArrowLeft') { e.preventDefault(); prev(); }
      else if (e.key === ' ' || e.code === 'Space') { e.preventDefault(); toggleAnswer(); }
      else if (e.key.toLowerCase() === 'r') { e.preventDefault(); setOrder(true); render(true); }
      else if (e.key === 'Escape') { e.preventDefault(); showCategorySelector(); }
    });
  </script>
</body>
</html>